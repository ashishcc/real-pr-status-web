<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Sign In</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="login-container">
    <div class="login-card">
      <div class="login-header">
        <ion-icon name="git-pull-request-outline" class="logo-icon"></ion-icon>
        <h1>GitHub PR Tracker</h1>
        <p>Sign in to access your pull request dashboard</p>
      </div>

      <div class="login-form">
        <!-- Step 1: Email input -->
        <div *ngIf="showEmailInput" class="email-section">
          <ion-item>
            <ion-label position="stacked">Email Address</ion-label>
            <ion-input 
              type="email" 
              [(ngModel)]="email" 
              placeholder="Enter your email"
              (keyup.enter)="checkEmailSSO()"
              [disabled]="loading">
            </ion-input>
          </ion-item>
          
          <ion-button 
            expand="block" 
            (click)="checkEmailSSO()"
            [disabled]="loading || !email"
            class="continue-button">
            <span *ngIf="!loading">Continue</span>
            <span *ngIf="loading">Checking...</span>
          </ion-button>

          <!-- For local testing -->
          <div *ngIf="!loading" class="test-section">
            <div class="divider">
              <span>OR</span>
            </div>
            
            <ion-button 
              expand="block" 
              fill="outline"
              (click)="signInWithMockAuth()"
              *ngIf="true"
              class="test-button">
              <ion-icon name="bug-outline" slot="start"></ion-icon>
              Test with Mock Auth (Dev Only)
            </ion-button>
          </div>
        </div>

        <!-- Step 3: Show Google Sign-in button after email check -->
        <div *ngIf="!showEmailInput && ssoInfo" class="sso-section">
          <div class="email-display">
            <ion-text color="medium">
              <p>Signing in as:</p>
            </ion-text>
            <h3>{{ email }}</h3>
          </div>

          <ion-button 
            expand="block" 
            (click)="signInWithGoogleForEmail()"
            [disabled]="loading"
            [class]="isLocalhost() ? 'test-button' : 'google-button'">
            <ion-icon [name]="isLocalhost() ? 'bug-outline' : 'logo-google'" slot="start"></ion-icon>
            <span *ngIf="!loading && !isLocalhost()">Sign in as {{ email }}</span>
            <span *ngIf="!loading && isLocalhost()">Sign in as {{ email }} (Mock Auth)</span>
            <span *ngIf="loading">Signing in...</span>
          </ion-button>

          <!-- Hidden div for Google Sign-In SDK to render button -->
          <div id="googleSignInDiv" style="display: none;"></div>

          <ion-button 
            expand="block" 
            fill="clear"
            (click)="resetToEmailInput()"
            [disabled]="loading"
            size="small">
            Use a different email
          </ion-button>
        </div>
      </div>

      <div class="login-footer">
        <p>By signing in, you agree to our Terms of Service</p>
      </div>
    </div>
  </div>
</ion-content>